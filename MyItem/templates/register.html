{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}天天生鲜-注册{% endblock title %}
{% block header_con %}
    <script type="text/javascript" src="../static/js/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="../static/js/register.js"></script>
{% endblock header_con %}
{% block search_bar %}{% endblock search_bar %}
{% block body %}

    <div class="register_con">
        <div class="l_con fl">
            <a class="reg_logo"><img src="../static/images/logo02.png"></a>
            <div class="reg_slogan">足不出户 · 新鲜每一天</div>
            <div class="reg_banner"></div>
        </div>

        <div class="r_con fr">
            <div class="reg_title clearfix">
                <h1>用户注册</h1>
                <a href="{% url 'user:login' %}">登录</a>
            </div>
            <div class="reg_form clearfix">
                {{ errmsg }}
                <form method="post" action="/user/register">
                    {% csrf_token %}
                    <ul>
                        <li>
                            <label>用户名:</label>
                            <input type="text" name="user_name" id="user_name" style="float:left">
                            <span id="user_name_err"></span>
                            <span class="error_tip">提示信息</span>

                        </li>
                        <li>
                            <label>密码:</label>
                            <input type="password" name="pwd" id="pwd">
                            <span class="error_tip">提示信息</span>
                        </li>
                        <li>
                            <label>确认密码:</label>
                            <input type="password" name="cpwd" id="cpwd">
                            <span class="error_tip">提示信息</span>
                        </li>
                        <li>
                            <label>邮箱:</label>
                            <input type="text" name="email" id="email">
                            <span class="error_tip">提示信息</span>
                        </li>
                        <li class="agreement">
                            <input type="checkbox" name="allow" id="allow" checked="checked">
                            <label>同意”天天生鲜用户使用协议“</label>
                            <span class="error_tip2">提示信息</span>
                        </li>
                        <li class="reg_sub">
                            <input type="submit" value="注 册" name="">
                        </li>
                    </ul>
                </form>
            </div>
        </div>
    </div>

{% endblock body %}

{% block bottomfiles %}
    <script>
        var user_name = document.getElementById('user_name');
        user_name.onblur = function () {
            /*获取XMLRequest的对象，可以发送异步请求*/
            var xmlhttp;
            if (window.XMLHttpRequest) {
                xmlhttp = new XMLHttpRequest();
            }
            else {
                xmlhttp = new ActiveXObject('Microsoft.XMLHTTP');
            }
            /*绑定事件*/
            xmlhttp.onreadystatechange = function (data) {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    console.info(xmlhttp.responseText);
                    if(xmlhttp.responseText=='1'){
                        document.getElementById('user_name_err').innerText='用户名已存在';
                    }
                    else if (xmlhttp.responseText=='0') {
                        document.getElementById('user_name_err').innerText='用户名可用';
                    }
                    else {
                        document.getElementById('user_name_err').innerText='';
                    }
                }
            };
            /*准备发送*/
            xmlhttp.open('get', '/user/checkusername?user_name='+user_name.value, true);
            xmlhttp.send()
        }
    </script>
{% endblock bottomfiles %}